\section{Background}

\subsection{Modular forms}

In this section, we give a brief introduction of modular forms, following \cite{Shurman}.

Let $\HH := \{ \tau \in \CC: Im(\tau) > 0 \}$ be the upper half complex plane. The special linear group $\SL_2(\ZZ)$ acts on $\HH$ via fractional linear transformations:

\[
\gamma \cdot \tau = \frac{a\tau + b}{c \tau + d}
\] 

where $\gamma = \begin{psmallmatrix} a & b \\ c & d \end{psmallmatrix}, \tau \in \HH$. 

\begin{defn}
Let $f: \HH \rightarrow \CC$ be a function and $k \in \ZZ$. 

\begin{itemize}
    \item The \textit{automorphy factor} is a function \begin{align*}j: \GL_2^+(\RR) \times \HH &\rightarrow \CC \\ (\gamma,z) &\mapsto cz+d \end{align*}
    where $\gamma = \begin{psmallmatrix} a & b \\ c & d \end{psmallmatrix}$.
    \item The \textit{weight-$k$ slash operator} is defined as 
    \begin{align*}
( \ \cdot \ )|_k (\ \cdot \ ): \Hom(\HH,\CC) \times \GL_2^+(\RR) &\rightarrow \Hom(\HH,\CC) \\
(f(z),\gamma) &\mapsto (f|_k \gamma)(z) := (\det \gamma)^{k-1} j(\gamma,z)^{-k} f(\gamma \cdot z).
    \end{align*}
    \end{itemize}
\end{defn}

The automorphy factory satisfies a cocycle relation $j(\gamma_1\gamma2,z) = j(\gamma_1,\gamma_2 z)j(\gamma_2,z)$ which implies that $\GL_2^+(\RR)$ acts on $\Hom(\HH,\CC)$ via $f|_k\gamma_1\gamma_2 = (f|_k\gamma_1)|_k\gamma_2$.

Consider the projection map $\pi: \SL_2(\ZZ) \rightarrow \SL_2(\ZZ/N\ZZ)$. We define congruence subgroups in the following way.

\begin{example}\label{example:1_congsgp}
Here are some common examples of preimages of $\pi$:

\begin{itemize}
    \item $\Gamma(N) = \pi^{-1} (\begin{psmallmatrix}
        1 & 0 \\ 0 & 1
    \end{psmallmatrix}) = \{ \begin{psmallmatrix}
        a & b \\ c & d 
    \end{psmallmatrix} \in \SL_2(\ZZ): \begin{psmallmatrix}
        a & b \\ c & d 
    \end{psmallmatrix} \equiv \begin{psmallmatrix}
        1 & 0 \\ 0 & 1 
    \end{psmallmatrix} \pmod{N}\}$.
    \item $\Gamma_1(N) = \pi^{-1} (\{\begin{psmallmatrix}
        1 & \ast \\ 0 & 1
    \end{psmallmatrix}\}) = \{ \begin{psmallmatrix}
        a & b \\ c & d 
    \end{psmallmatrix} \in \SL_2(\ZZ): \begin{psmallmatrix}
        a & b \\ c & d 
    \end{psmallmatrix} \equiv \begin{psmallmatrix}
        1 & \ast \\ 0 & 1 
    \end{psmallmatrix} \pmod{N}\}$.
    \item $\Gamma_0(N) = \pi^{-1} (\{\begin{psmallmatrix}
        \ast & \ast \\ 0 & \ast
    \end{psmallmatrix}\}) = \{ \begin{psmallmatrix}
        a & b \\ c & d 
    \end{psmallmatrix} \in \SL_2(\ZZ): \begin{psmallmatrix}
        a & b \\ c & d 
    \end{psmallmatrix} \equiv \begin{psmallmatrix}
        \ast & \ast \\ 0 & \ast 
    \end{psmallmatrix} \pmod{N}\}$.
\end{itemize}
\end{example}

\begin{defn}
$\Gamma \leq \SL_2(\ZZ)$ is a \textit{congruence subgroup} if there exists an integer $N \geq 1$ such that $\Gamma(N) \leq \Gamma$. The minimal such $N$ is called the \textit{level} of $\Gamma$.

It follows immediately that congruence subgroups of $\SL_2(\ZZ)$ have finite index and correspond to subgroups of $\SL_2(\ZZ/N\ZZ)$. The above examples are all congruence subgroups of level $N$.
\end{defn}

\begin{defn}
    Let $\Gamma \leq \SL_2(\ZZ)$ be a congruence subgroup of level $N$, $k \geq 0$ an integer. We say a function $f: \HH \rightarrow \CC$ is a \textit{modular form of weight $k$ with level $\Gamma$} if

    \begin{enumerate}
        \item $f$ is holomorphic,
        \item $f$ is weight-$k$ invariant under $\Gamma$, i.e., $f|_k\gamma = f$ for all $\gamma \in \Gamma$,
        \item $f|_k\alpha $ is holomorphic at $\infty$ for all $\alpha \in \SL_2(\ZZ)$, i.e., $(f|_k \alpha )(z)$ is bounded as $z \rightarrow i\infty$.
    \end{enumerate}

    If, in addition, $f|_k \alpha$ vanishes at infinity for all $\alpha \in \SL_2(\ZZ)$, we say that $f$ is a \textit{cusp form}. We denote the set of weight-$k$ modular forms with respect to $\Gamma$ (resp. cusp forms) as $\mathcal{M}_k(\Gamma)$ (resp. $\mathcal{S}_k(\Gamma)$).
\end{defn}

Suppose $f$ is a modular form of weight $k$ with level $\Gamma$. Since $\Gamma$ is a congruence subgroup, $\begin{psmallmatrix}
    1 & h \\ 0 & 1
\end{psmallmatrix} \in \Gamma$ for some minimal integer $h\geq 1$, this integer is the \textit{width} of the cusp $\infty$. Since a modular form satisfies $f|_k \gamma = f$ for $\gamma \in \Gamma$, we have $(f|_k \begin{psmallmatrix}
    1 & h \\ 0 & 1
\end{psmallmatrix})(z) = f(z+h) = f(z) $, so $f(z)$ is $h\ZZ$-periodic and admits a Fourier expansion $f(\tau) = \sum_{n=0}^\infty a_n q_{h}^n$ where $q_h = \exp(2\pi i\tau / h)$. The third condition of modular forms implies that the Fourier expansion begins at index $0$ and cusp forms satisfy $a_0 = 0$.

\begin{example}
Let $G_k(\tau) = \sum_{(c,d) \not = (0,0)} 1/(c\tau + d)^k$. This is a modular form of weight $k$ for $\SL_2(\ZZ)$ called \textit{Eisenstein series}. 

    The \textit{$j$-invariant} is a modular form of weight $0$, i.e., a modular function and an element of $\CC(X(\SL_2(\ZZ)))$, with $q$-expansion:

    \begin{align*}
        j: \HH \rightarrow \CC, j(\tau) = 1728 \frac{(60 G_4(\tau))^3}{(60 G_4(\tau))^3 - 27 (140 G_6(\tau))^2} = \frac{1}{q} + 744 + 196884q + \ldots.
    \end{align*}
\end{example}

It is a standard result that $\mathcal{M}_k(\Gamma) \supseteq \mathcal{S}_k(\Gamma)$ are finite dimensional complex vector spaces. Modular forms and modular curves are related by the fact that there is an isomorphism between the space of weight $2$ cusp forms and the space of holomorphic differentials on the modular curve $X(\Gamma)$. 

\begin{align*}
\mathcal{S}_2(\Gamma) &\xrightarrow{\cong} H^0(X(\Gamma),\Omega^1) \\
f(\tau) &\mapsto f(\tau) d\tau.
\end{align*}



\subsection{Modular curves}
In this section, we define our object of study. Modular curves have rich structures as Riemann surfaces, algebraic curves and moduli spaces of elliptic curves (with some torsion information). We frequently use properties from various perspectives interchangeably.

\subsubsection{As Riemann surfaces}
Let $\Gamma \leq \SL_2(\ZZ)$ be a subgroup of finite index. $\HH$ inherits the Euclidean topology from $\CC$ and so $Y(\Gamma) := \Gamma \backslash \HH$ carries the quotient topology that is Hausdorff. $Y(\Gamma)$ can be compactified by adjoining cusps, which are orbits of $\PP^1(\QQ)$ under the action of $\Gamma$. The resulting quotient space $X(\Gamma) := \Gamma \backslash \HH^*$ where $\HH^* := \HH \cup \PP^1(\QQ)$ is called the modular curve associated to $\Gamma$. One could further show that by considering elliptic points and cusps, one can choose suitable charts, therefore giving $Y(\Gamma)$ and $X(\Gamma)$ the structure of Riemann surface.

This approach allows us to use techniques from Riemann surfaces, e.g., genus/ramification theory, Riemann-Hurwitz formula, Riemann-Roch, etc. to study modular curves.

\subsubsection{As algebraic curves}

For a finite index subgroup $\Gamma \leq \SL_2(\ZZ)$. The associated modular curve $X(\Gamma)$ has the structure of a compact Riemann surface. Compact Riemann surfaces and complex algebraic curves are equivalent notions \cite{forster}. Note that we are also considering modular curves where the determinant map on the subgroup $H \leq \GL_2(\ZZ/N\ZZ)$ is surjective. By Theorem 7.6.3 in \cite{Shurman}, these algebraic curves are in fact defined over $\QQ$. We have a Galois-theoretic correspondence between curves and their function fields:

\begin{theorem}{(Curves-Fields Correspondence)} For any field $k$, there is a bijection:

\begin{align*}
\{\text{$C/k$ smooth projective algebraic curves}\}/\cong &\leftrightarrow \{\text{$K/k$ function field extensions over $k$}\}/\sim \\
C &\mapsto k(C)
\end{align*}

Furthermore, this is contravariant: a nonconstant morphism from  algebraic curves $C$ to $C'$ over $k$ corresponds to a field morphism from $k(C')$ to $k(C)$.

\end{theorem}

The above theorem allows us to work with simpler objects, i.e., we can replace curves and their morphisms by fields and field injections. In particular, the function field of the modular curve $X(\Gamma)$ consists of modular functions of weight $0$ and level $\Gamma$. 

\subsubsection{As moduli spaces of elliptic curves}

For each $\tau \in \HH$, one could associate it with a lattice $\Lambda_\tau := \ZZ + \tau \cdot \ZZ \subseteq \CC$. The resulting quotient space $\CC/\Lambda_\tau$ is a compact Riemann surface of genus $1$, an elliptic curve. Conversely, for any elliptic curve, as a genus 1 compact Riemann surface, the homology group of the elliptic curve $H_1(E,\ZZ)$ is generated by two loops, $\gamma_1, \gamma_2$. For an invariant differential $\omega$ of the elliptic curve, we can construct the lattice generated by the periods $\Lambda_E = (\int_{\gamma_1} \omega) \cdot \ZZ + (\int_{\gamma_2} \omega) \cdot \ZZ$. This can be renormalised so that $\Lambda_E = \ZZ + \tau \cdot \ZZ$ with $\tau = (\int_{\gamma_1} \omega) /(\int_{\gamma_2} \omega) \in \HH$. In particular the points on $\HH$ correspond to elliptic curves.

For $\Gamma \leq \SL_2(\ZZ)$, the modular curve $X(\Gamma)(\bar{\QQ})$ parametrise elliptic curves with some torsion data, i.e., a pair $(E, \phi)$ where $E$ is an elliptic curve defined over $\bar{\QQ}$ and $\phi$ is an isomorphism of its $N$-torsion points $\phi: E[N] \rightarrow (\ZZ/N\ZZ)^2$. Two points $(E_1,\phi_1), (E_2,\phi_2)$ are isomorphic if there is an isomorphism of elliptic curves $\psi: E_1 \rightarrow E_2$ and some matrix $M \in \Gamma$ such that the diagram commutes:

\begin{center}
  \begin{tikzcd}
    E_1[N] \arrow[r, "\phi_1"] \arrow[d, "\psi"] & (\ZZ/N\ZZ)^2 \arrow[d,  "M"] \\
    E_2[N] \arrow[r, "\phi_2"]                &  (\ZZ/N\ZZ)^2.                               
  \end{tikzcd}
\end{center}


Furthermore, there is an action of the absolute Galois group $Gal(\bar{\QQ}/\QQ)$ on $(E,\phi)$ and we say that $(E,\phi)$ is a $\QQ$-rational point if it is invariant under the action. We can view points on modular curves as elliptic curves with certain torsion structures which allows us to apply properties of elliptic curves to study the rational points on $X(\Gamma)$.

\begin{example}
Let $H \leq \GL_2(\ZZ/N\ZZ)$ be a subgroup such that
\begin{itemize}
    \item $-I \in H$,
    \item the determinant map $\det: H \rightarrow (\ZZ/N\ZZ)^\times$ is surjective.
\end{itemize}
Then for an integer $N \geq 1$, we have the congruence subgroup $\Gamma_H(N) = \{ A \in \SL_2(\ZZ) : A \pmod{N} \in H \}$, which gives rise to the modular curves $X_H := X(\Gamma_H(N))$.

Following Example \ref{example:1_congsgp}, the corresponding modular curves parametrise:

\begin{itemize}
    \item $X(N):= X(\Gamma(N))$ consists of $(E,(P,Q))$ an elliptic curve and a pair of points generating the $N$-torsion subgroup of $E$.
    \item $X_1(N) := X(\Gamma_1(N))$ consists of $(E,Q)$ an elliptic curve and a point of order $N$.
    \item $X_0(N) := X(\Gamma_0(N))$ consists of $(E,C)$ an elliptic curve and a cyclic subgroup of order $N$.
\end{itemize}
\end{example}

\subsection{Hecke operators}

We begin with the definition of Hecke operators as operators on spaces of modular forms. These are used in conjunction with spectral theory to show that the inner product space of modular forms contains a basis of modular forms that are eigenvectors under the Hecke operators $\{T_p\}_p$. Hecke operators are defined on modular forms and modular curves. We use both the transcendental and algebraic/geometric definitions of Hecke operators in our algorithm.

\begin{defn}
Let $\Gamma_1, \Gamma_2$ be congruence subgroups of $SL_2(\ZZ)$ and $\alpha \in GL_2^+(\QQ)$. 

\begin{itemize}
    \item We define the \textit{double coset} $\Gamma_1 \alpha \Gamma_2$ as the set 

\[
\Gamma_1 \alpha \Gamma_2 := \{\gamma_1 \alpha \gamma_2 : \gamma_1 \in \Gamma_1, \gamma_2 \in \Gamma_2\}
\]
\item This gives rise to the \textit{double coset operators}:

\begin{align*}
(\ \cdot \ )|_k [\Gamma_1 \alpha \Gamma_2] : \mathcal{M}_k(\Gamma_1) &\rightarrow \mathcal{M}_k(\Gamma_2) \\
f(\tau) &\mapsto f|_k \Gamma_1 \alpha \Gamma_2 := \sum_i f|_k \beta_i
\end{align*}

where $\Gamma_1 \alpha \Gamma_2 = \bigcup_i \Gamma_1 \beta_i$ is a (finite) disjoint coset decomposition that does not depend on the choice of decomposition. This map restricts to an operator on the space of cusp forms $(\ \cdot \ )|_k [\Gamma_1 \alpha \Gamma_2] : \mathcal{S}_k(\Gamma_1) \rightarrow \mathcal{S}_k(\Gamma_2)$.
\end{itemize}
\end{defn}

We follow the approach \cite{Assaf2020} to define Hecke operators.

\begin{defn}
Fix a congruence subgroup $\Gamma$ with $\bar{\Gamma} \leq SL_2(\ZZ/N\ZZ)$.
Let $\alpha \in M_2(\ZZ)$ such that $\det (\alpha) \in \det (\bar{\Gamma})$ and $\alpha \pmod{N} \in \bar{\Gamma}$. We define the Hecke operator as

\[
T_p = T_\alpha = ( \ \cdot \ )|_k [\Gamma \alpha \Gamma]
\]
\end{defn}

\begin{example} (\cite{Shurman} Prop. 5.2.1)
The theory of Hecke operators can be made explicit for certain congruence subgroups. The Hecke operator $T_p = [ \Gamma_1(N) \begin{psmallmatrix} 1 & 0 \\ 0 & p \end{psmallmatrix} \Gamma_1(N)]_k $ on $\mathcal{M}_k(\Gamma_1(N))$ has the following formulae:

\[T_p f =
\begin{cases}
\sum_{i = 0}^{p-1} f|_k \begin{psmallmatrix}
    1 & j \\ 0 & p \end{psmallmatrix}, & \text{if $p | N$,} \\
\sum_{i = 0}^{p-1} f|_k \begin{psmallmatrix}
    1 & j \\ 0 & p \end{psmallmatrix} + f|_k (\begin{psmallmatrix} m & n \\ N & p \end{psmallmatrix} \begin{psmallmatrix}
        p & 0 \\ 0 & 1
    \end{psmallmatrix}), & \text{if $p\not | N$, where $mp - nN = 1$.} \\
\end{cases} 
\]
\end{example}

%Since we can view $\tau \in \HH$ as lattices $\Lambda_\tau$, modular forms can be viewed as functions on rank $1$ lattices. In particular, the Hecke operators above can be reinterpreted as 

%\[T_p f (\Lambda) = p^{k-1} \sum_{\Lambda' \subseteq \Lambda, [\Lambda:\Lambda'] = p} f(\Lambda')\]

There is also an algebraic/geometric interpretation of the double coset operator as a morphism of divisor groups. For $\Gamma_1, \Gamma_2$ congruence subgroups, $\alpha \in GL_2^+(\QQ) $, $\Gamma_3 := \alpha^{-1} \Gamma_1 \alpha \cap \Gamma_2$ and $\Gamma_3' := \alpha \Gamma_3 \alpha^{-1}$. Since points on the modular curve $X(\Gamma)$ have the form $\Gamma \tau$, we have a diagram at the level of groups which induces a diagram on modular curves:


\begin{align*}
\Gamma_2 \hookleftarrow \Gamma_3 \xrightarrow{\cong} \Gamma_3' \hookrightarrow \Gamma_1 \\
X_2 \xleftarrow{\pi_2} X_3 \xrightarrow{\cong} X_3' \xrightarrow{\pi_1} X_1
\end{align*}

Suppose $\Gamma_3 / \Gamma_2 = \bigcup_j \Gamma_3 \gamma_{2,j}$ and $\beta_j = \alpha \gamma_{2,j}$. Then the double coset operator induces a map on the divisor groups  after $\ZZ$-linear extension:

\begin{align*}
    \Div(X_2) &\rightarrow \Div(X_1) \\
    \Gamma_2 \tau &\mapsto \sum_j \Gamma_1 \beta_j \tau
\end{align*}

Specialising to the case of Hecke operator, we obtain a similar diagram. 

We could benefit from the moduli interpretation of modular curves for the case of Hecke operators by defining it as a correspondence. For $H \leq GL_2(\ZZ/N\ZZ)$ and $p$ coprime to $N$, we obtain the modular curve $X_H$ and its fiber product $X_H(p) := X_0(p) \times_{X(1)} X_H$. There are two degeneracy maps $\alpha,\beta: X_H(p) \rightarrow X_H$ defining the Hecke operator at $p$ where one forgets the cyclic group of order $p$ and the other quotients out by the cyclic group of order $p$.


\[
\begin{tikzcd}[column sep=small]
 & X_H(p) \arrow{dl}[swap]{\alpha} \arrow{dr}{\beta} & \\
X_H \arrow[rr,dashed] & & X_H
\end{tikzcd}
\]

By Picard functoriality, for a point $(E,\mathfrak{n}) \in X_H$ where the level structure $\mathfrak{n}$ is determined by $H$, we have an algebraic description of the Hecke operator at $p$: \[T_p(E,\mathfrak{n)} := \alpha^* \beta_* (E,\mathfrak{n}) = \sum_{f:E\rightarrow E', deg(f) = p} (E',f(\mathfrak{n})).\]


\subsection{Coleman integrals}\label{sec:coleman_integration}

Coleman's construction of $p$-adic line integrals share many similar properties as their complex-analytic analogue. Below we record some properties of Coleman integrals from \cite{Coleman1,coleman85} that will be used in our calculations.

\begin{theorem} \label{coleman_def}
Let $X/\QQ_p$ be a smooth, projective, and geometrically irreducible curve with good reduction at $p$, let $J$ be the Jacobian of $X$.Then there is a $p$-adic integral 

\[ \int_P^Q \omega \in \overline{\QQ}_p\]

with $P,Q \in X(\overline{\QQ}_p), \omega \in H^0(X,\Omega^1)$ satisfying:

\begin{enumerate}
    \item The integral is $\overline{\QQ}_p$ linear in $\omega$,
    \item We have additivity of endpoints:
    \begin{equation*}
        \int_P^Q \omega = \int_P^R \omega + \int_R^Q \omega,
    \end{equation*}
    \item 
    \begin{equation*}
        \int_P^Q \omega + \int_{P'}^{Q'} \omega = \int_P^{Q'} \omega + \int_{P'}^Q \omega
    \end{equation*}
        Thus, we can define $\int_D \omega$, where $D \in Div^0_X(\overline{\QQ}_p)$. Also, if $D$ is principal, $\int_D \omega = 0$,
        
    \item There is an open subgroup of $J(\QQ_p)$ such that $\int_P^Q \omega$ can be computed in terms of power series in some uniformiser by formal term-by-term integration. In particular, $\int_P^P \omega = 0$,



        \item The integral is compatible with the action of $Gal(\overline{\QQ}_p/\QQ_p)$. In particular, if $P,Q \in X(\QQ_p)$ then $\int_P^Q \omega \in \QQ_p$.
        \item Let $P_0 \in X(\overline{\QQ}_p)$ be fixed and $\omega \neq 0$. Then the set of $P \in X(\overline{\QQ}_p)$ reducing to $X(\overline{\FF}_p)$ such that $\int_{P_0}^P \omega = 0$ is finite,

        \item If $U \subseteq X, V \subseteq Y $ are wide open subspaces of the rigid analytic spaces $X,Y$, $\omega$ a 1-form on $V$, and $\phi:U \rightarrow V$ a rigid analytic map, then we have the change of variables formula:
        
        \begin{equation*}
            \int_P^Q \phi^* \omega = \int_{\phi(P)}^{\phi(Q)} \omega,
        \end{equation*}
        \item We have an analogue of the Fundamental Theorem of Calculus: $\int_P^Q df = f(Q) - f(P)$,

\end{enumerate}
\end{theorem}

\begin{defn}\label{def:tiny_integral}
The Coleman integral $\int_P^Q \omega$ is called a \emph{tiny integral} if $P$ and $Q$ reduce to the same point in $X_{\FF_p}(\overline{\FF}_p)$, i.e., they lie in the same residue disc.

\end{defn}


Explicitly, if $P$ and $Q$ are in the same residue disc, then the differential form can be expressed as a power series in terms of a uniformiser at $P$. The tiny integral can be computed by formally integrating the power series and evaluated at the endpoints: \[\int_P^Q \omega = \int_{t(P)}^{t(Q)} \omega(t) = \int_{t(P)}^{t(Q)}\sum a_i t^i dt= \sum \frac{a_i}{i+1} (t(Q) - t(P))^{i+1}.\]


Coleman’s construction is suitable for computations. In \cite{BBK10}, the authors demonstrated an algorithm to compute single Coleman integrals for hyperelliptic curves. Their method is based on Kedlaya's algorithm for computing the Frobenius action on the de Rham cohomology of hyperelliptic curves \cite{Kedlaya_coho_hyper} and this is generalized to arbitrary smooth curves \cite{balatuit, Tui16, Tui17}. Despite recent developments in this direction, the current implementations require nice affine plane models for the curves as inputs. Since modular curves tend to have large gonality, such models are not readily available and are often bottlenecks in existing algorithms.